#!/usr/bin/env python3
"""
æµ‹è¯• show_text_oled ä¿®å¤
éªŒè¯ä¿®å¤åçš„ show_text_oled ä¼šæ»šåŠ¨ä¸€éåç»“æŸï¼Œä¸ä¼šå¡æ­»
"""

import os
import sys
import time

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„
project_root = os.path.dirname(os.path.abspath(__file__))
sys.path.insert(0, project_root)

def test_show_text_oled():
    """æµ‹è¯•ä¿®å¤åçš„ show_text_oled æ–¹æ³•"""
    try:
        print("ğŸ§ª æµ‹è¯• show_text_oled ä¿®å¤...")
        
        # å¯¼å…¥æ˜¾ç¤ºç®¡ç†å™¨
        from core.display.display_utils import DisplayManager
        
        # åˆå§‹åŒ–OLEDæ˜¾ç¤º
        print("1. åˆå§‹åŒ–OLEDæ˜¾ç¤º...")
        oled = DisplayManager("OLED")
        print("âœ… OLEDåˆå§‹åŒ–æˆåŠŸ")
        
        # æµ‹è¯•çŸ­æ–‡æœ¬ (ä¸éœ€è¦æ»šåŠ¨)
        print("2. æµ‹è¯•çŸ­æ–‡æœ¬...")
        start_time = time.time()
        oled.show_text_oled("æµ‹è¯•çŸ­æ–‡æœ¬")
        end_time = time.time()
        print(f"âœ… çŸ­æ–‡æœ¬æ˜¾ç¤ºå®Œæˆï¼Œè€—æ—¶: {end_time - start_time:.2f}ç§’")
        time.sleep(1)
        
        # æµ‹è¯•å¤šè¡Œæ–‡æœ¬ (ä¸éœ€è¦æ»šåŠ¨)
        print("3. æµ‹è¯•å¤šè¡Œæ–‡æœ¬...")
        start_time = time.time()
        oled.show_text_oled("ç¬¬ä¸€è¡Œ\nç¬¬äºŒè¡Œ\nç¬¬ä¸‰è¡Œ")
        end_time = time.time()
        print(f"âœ… å¤šè¡Œæ–‡æœ¬æ˜¾ç¤ºå®Œæˆï¼Œè€—æ—¶: {end_time - start_time:.2f}ç§’")
        time.sleep(1)
        
        # æµ‹è¯•é•¿æ–‡æœ¬ (éœ€è¦æ»šåŠ¨æ˜¾ç¤º)
        print("4. æµ‹è¯•é•¿æ–‡æœ¬æ»šåŠ¨ (ä¹‹å‰ä¼šå¡æ­»)...")
        long_text = """ğŸŒŸ å²è±å§†æ¼‚æµç³»ç»Ÿ

æ¬¢è¿æ¥åˆ°æ¼‚æµä¸–ç•Œï¼
è®©æˆ‘ä»¬å¼€å§‹ä½ çš„
ä¸“å±å²è±å§†ä¹‹æ—…

è¿™æ˜¯ç¬¬äºŒé¡µçš„å†…å®¹
ä½ ç°åœ¨çœ‹åˆ°çš„æ˜¯
æ»šåŠ¨æ˜¾ç¤ºçš„æ•ˆæœ

è¿™æ˜¯ç¬¬ä¸‰é¡µçš„å†…å®¹
ç³»ç»Ÿä¼šè‡ªåŠ¨æ»šåŠ¨
æ˜¾ç¤ºæ‰€æœ‰å†…å®¹

æœ€åä¸€é¡µå†…å®¹
æ»šåŠ¨å®Œæˆåä¼šç»“æŸ
ä¸ä¼šæ— é™å¾ªç¯äº†ï¼"""
        
        print("   è§‚å¯ŸOLEDå±å¹•ï¼Œåº”è¯¥çœ‹åˆ°åˆ†é¡µæ»šåŠ¨æ˜¾ç¤º...")
        start_time = time.time()
        oled.show_text_oled(long_text)
        end_time = time.time()
        
        duration = end_time - start_time
        print(f"âœ… é•¿æ–‡æœ¬æ»šåŠ¨æ˜¾ç¤ºå®Œæˆï¼Œæ€»è€—æ—¶: {duration:.2f}ç§’")
        
        # é¢„æœŸæ—¶é—´åº”è¯¥æ˜¯ï¼š2.5ç§’(é¦–é¡µ) + 1.5ç§’(ä¸­é—´é¡µ) + 2.5ç§’(æœ«é¡µ) = çº¦6.5ç§’å·¦å³
        if 5.0 < duration < 15.0:  # åˆç†çš„æ»šåŠ¨æ—¶é—´èŒƒå›´
            print("ğŸ‰ æ»šåŠ¨æ—¶é—´åˆç†ï¼Œä¿®å¤æˆåŠŸï¼")
        elif duration < 2.0:
            print("âš ï¸ å¯èƒ½æ²¡æœ‰æ»šåŠ¨ï¼Œæ—¶é—´è¿‡çŸ­")
        else:
            print("âš ï¸ æ»šåŠ¨æ—¶é—´å¼‚å¸¸ï¼Œå¯èƒ½ä»æœ‰é—®é¢˜")
        
        time.sleep(1)
        
        # æµ‹è¯•è¶…é•¿æ–‡æœ¬
        print("5. æµ‹è¯•è¶…é•¿æ–‡æœ¬...")
        super_long_text = """ç¬¬ä¸€é¡µï¼šå²è±å§†æ¼‚æµç³»ç»Ÿæ˜¯ä¸€ä¸ªäº’åŠ¨å¼çš„ARä½“éªŒé¡¹ç›®ã€‚

ç¬¬äºŒé¡µï¼šç”¨æˆ·å¯ä»¥é€šè¿‡è¯­éŸ³è¾“å…¥è‡ªå·±çš„å¿ƒæƒ…çŠ¶æ€ï¼Œç³»ç»Ÿä¼šç”Ÿæˆå¯¹åº”çš„å²è±å§†è§’è‰²ã€‚

ç¬¬ä¸‰é¡µï¼šå²è±å§†æœ‰è‡ªå·±çš„æ€§æ ¼ç‰¹ç‚¹ã€æ‰§å¿µã€å¹»æƒ³ç™–å¥½ç­‰å±æ€§ã€‚

ç¬¬å››é¡µï¼šç”¨æˆ·å¯ä»¥å’Œå²è±å§†ä¸€èµ·æ‹ç…§æ¢ç´¢ï¼Œå¯»æ‰¾ç¬¦åˆå²è±å§†æ‰§å¿µçš„åœºæ™¯ã€‚

ç¬¬äº”é¡µï¼šç³»ç»Ÿä¼šæ ¹æ®ç…§ç‰‡å†…å®¹ç»™å‡ºç›¸åº”çš„å¥–åŠ±ï¼ŒåŒ…æ‹¬è£…é¥°å“æˆ–å²è±å§†è›‹ã€‚

ç¬¬å…­é¡µï¼šè¿™æ˜¯æœ€åä¸€é¡µï¼Œæ¼”ç¤ºæ»šåŠ¨æ˜¾ç¤ºåŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚"""
        
        print("   è§‚å¯Ÿæ›´é•¿çš„æ»šåŠ¨è¿‡ç¨‹...")
        start_time = time.time()
        oled.show_text_oled(super_long_text)
        end_time = time.time()
        
        print(f"âœ… è¶…é•¿æ–‡æœ¬æ»šåŠ¨å®Œæˆï¼Œè€—æ—¶: {end_time - start_time:.2f}ç§’")
        
        # æ¸…ç†æ˜¾ç¤º
        print("6. æ¸…ç†æ˜¾ç¤º...")
        oled.clear()
        print("âœ… æ¸…ç†å®Œæˆ")
        
        return True
        
    except Exception as e:
        print(f"âŒ æµ‹è¯•å¤±è´¥: {e}")
        import traceback
        traceback.print_exc()
        return False

def main():
    """ä¸»å‡½æ•°"""
    print("=" * 50)
    print("ğŸ”§ show_text_oled æ»šåŠ¨ä¿®å¤éªŒè¯æµ‹è¯•")
    print("=" * 50)
    
    success = test_show_text_oled()
    
    if success:
        print("\nğŸ‰ ä¿®å¤éªŒè¯æˆåŠŸï¼")
        print("ç°åœ¨ show_text_oled ä¼šæ»šåŠ¨ä¸€éæ˜¾ç¤ºå…¨éƒ¨å†…å®¹åç»“æŸ")
        print("ä¸ä¼šå†æ— é™å¾ªç¯å¡æ­»äº†")
        return 0
    else:
        print("\nâŒ ä¿®å¤éªŒè¯å¤±è´¥")
        print("å¯èƒ½éœ€è¦è¿›ä¸€æ­¥è°ƒè¯•")
        return 1

if __name__ == "__main__":
    sys.exit(main()) 